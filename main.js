(()=>{"use strict";var e=document.querySelector(".profile__image");document.querySelector(".header__logo").src="0863e5bc26221680f1e2.svg";var t=document.querySelector(".popup_type_edit"),r=t.querySelector(".popup__form"),n=(Array.from(r.querySelectorAll(".popup__input")),t.querySelector(".popup__input_type_description")),o=t.querySelector(".popup__input_type_name"),c=document.querySelector(".profile__title"),a=document.querySelector(".profile__description"),i=r.querySelector(".popup__button"),u=document.querySelector(".profile__edit-button"),d=document.querySelector(".places__list"),s=document.querySelector(".popup_type_new-card"),l=s.querySelector(".popup__form"),p=(Array.from(l.querySelectorAll(".popup__input")),document.querySelector(".popup__input_type_card-name")),_=l.querySelector(".popup__input_type_url"),v=l.querySelector(".popup__button"),f=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_new-avatar");y.addEventListener("click",C);var m=document.querySelector(".profile__image"),h=y.querySelector(".popup__form"),b=h.querySelector(".popup__input_type_url"),S=h.querySelector(".popup__button");function q(){o.validity.valid&&n.validity.valid?(i.classList.remove("popup__button_inactive"),i.disabled=!1):(i.classList.add("popup__button_inactive"),i.disabled=!0),p.validity.valid&&_.validity.valid?(v.classList.remove("popup__button_inactive"),v.disabled=!1):(v.classList.add("popup__button_inactive"),v.disabled=!0),b.validity.valid?(S.classList.remove("popup__button_inactive"),S.disabled=!1):(S.classList.add("popup__button_inactive"),S.disabled=!0)}function L(e){e.classList.add("popup__input_error");var t=document.querySelector(".".concat(e.id,"-error-message"));t.classList.add("popup__input_error-message_active"),t.textContent=e.validationMessage}function k(e){e.classList.remove("popup__input_error"),document.querySelector(".".concat(e.id,"-error-message")).classList.remove("popup__input_error-message_active")}function g(e){e.classList.add("popup_is-opened")}function E(e){e.classList.remove("popup_is-opened")}function C(e){e.target.classList.contains("popup")&&E(e.target)}m.addEventListener("click",(function(){b.value="",b.validity.valid?k(b):L(b),q(),g(y)})),y.querySelector(".popup__close").addEventListener("click",(function(){E(y)})),h.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=b.value,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:t})}).then(U)).then((function(e){m.style.backgroundImage="url(".concat(e.avatar,")"),E(y),h.reset()})).catch((function(e){console.error("updateAvatar() error: ".concat(e))}))})),Array.from(document.querySelectorAll(".popup__input")).forEach((function(e){e.addEventListener("input",(function(e){e.target.validity.valid?k(e.target):L(e.target),q()}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&E(t)}}));var x={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"77b672f1-b332-40f2-b12e-fd3bf3caef3f","Content-Type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}var A=null;function T(e,t){var r=document.querySelector(".popup_type_image"),n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);n.querySelector(".card__title").textContent=e.name;var o=n.querySelector(".card__image");o.src=e.link;var c=n.querySelector(".card__like-count");c.textContent=e.likes.length;var a=n.querySelector(".card__delete-button");e.owner._id!==t&&(a.style.visibility="hidden"),a.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(x.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:x.headers}).then(U)).then((function(){n.remove()})).catch((function(e){console.error("deleteCard() error: ".concat(e))}))}));var i=n.querySelector(".card__like-button");return e.likes.some((function(e){return e._id===t}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){var t;i.classList.contains("card__like-button_is-active")?(t=e._id,fetch("".concat(x.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:x.headers}).then(U)).then((function(e){i.classList.remove("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){console.error("unlikeCard() error:",e)})):function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then(U)}(e._id).then((function(e){i.classList.add("card__like-button_is-active"),c.textContent=e.likes.length})).catch((function(e){console.error("likeCard() error:",e)}))})),r.classList.add("popup_is-animated"),o.addEventListener("click",(function(){r.querySelector(".popup__caption").textContent=e.name,r.querySelector(".popup__image").src=e.link,g(r)})),r.querySelector(".popup__close").addEventListener("click",(function(){E(r)})),r.addEventListener("click",C),n}fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then(U).then((function(t){c.textContent=t.name,a.textContent=t.about,e.style.backgroundImage="url(".concat(t.avatar,")"),A=t._id})).catch((function(e){console.error("getUser() error: ".concat(e))})),fetch("".concat(x.baseUrl,"/cards"),{headers:x.headers}).then(U).then((function(e){e.forEach((function(e){d.append(T(e,A))}))})).catch((function(e){console.error("getInitialCards() error: ".concat(e))})),t.classList.add("popup_is-animated"),t.addEventListener("click",C),u.addEventListener("click",(function(){o.value=c.textContent,o.validity.valid?k(o):L(o),n.value=a.textContent,n.validity.valid?k(n):L(n),q(),g(t)})),t.querySelector(".popup__close").addEventListener("click",(function(){E(t)})),r.addEventListener("submit",(function(e){var r;e.preventDefault(),(r={name:o.value,about:n.value},fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify(r)}).then(U)).then((function(e){console.log(e),c.textContent=e.name,a.textContent=e.about,E(t)})).catch((function(e){console.error("updateUser() error: ".concat(e))}))})),s.classList.add("popup_is-animated"),s.addEventListener("click",C),f.addEventListener("click",(function(){p.value="",p.validity.valid?k(p):L(p),_.value="",_.validity.valid?k(_):L(_),q(),g(s)})),s.querySelector(".popup__close").addEventListener("click",(function(){E(s)})),l.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:p.value,link:_.value},fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify(t)}).then(U)).then((function(e){d.prepend(T(e,A)),E(s)})).catch((function(e){console.error("addNewCard() error: ".concat(e))}))}))})();